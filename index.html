<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathLine: –¢—Ä–µ–Ω–∞–∂–µ—Ä (6 –∫–ª–∞—Å—Å)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <!-- React & Babel for local execution -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .math-font { font-family: 'Fira Code', monospace; }
        .grid-paper { background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; }
        .animate-bounce-slow { animation: bounce 3s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <!-- We use type="text/babel" so Babel compiles this in the browser -->
    <script type="text/babel">
        // Import GoogleGenAI from a global-friendly CDN or use the module pattern if supported.
        // For a single HTML file to work perfectly local, we'll use a dynamic import for GenAI inside the logic.
        
        const { useState, useEffect, useMemo, useRef } = React;

        // --- CONSTANTS ---
        const LINE_MIN = -12;
        const LINE_MAX = 12;
        const STEP = 0.5;
        const VIEWBOX_WIDTH = 800;
        const VIEWBOX_HEIGHT = 150;
        const MARGIN_X = 50;
        const TOTAL_PROBLEMS = 10;

        // --- PROBLEM GENERATOR ---
        const generateProblems = () => [
            { id: 1, type: 'ADDITION', a: -5, b: 8, expression: "-5 + 8", answer: 3, description: "–ù–∞—á–Ω–∏ —Å -5 –∏ —Å–¥–µ–ª–∞–π 8 —à–∞–≥–æ–≤ –≤–ø—Ä–∞–≤–æ." },
            { id: 2, type: 'SUBTRACTION', a: -2, b: 6, expression: "-2 - 6", answer: -8, description: "–í—ã—á–∏—Ç–∞–Ω–∏–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ ‚Äî —ç—Ç–æ –≤—Å–µ–≥–¥–∞ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ." },
            { id: 3, type: 'SUBTRACTION', a: 4, b: -3, expression: "4 - (-3)", answer: 7, description: "–ú–∏–Ω—É—Å –Ω–∞ –º–∏–Ω—É—Å –¥–∞–µ—Ç –ø–ª—é—Å! –≠—Ç–æ –∫–∞–∫ –æ—Ç–º–µ–Ω–∞ –¥–æ–ª–≥–∞." },
            { id: 4, type: 'ADDITION', a: -1.5, b: 3.5, expression: "-1.5 + 3.5", answer: 2, description: "–ë—É–¥—å –≤–Ω–∏–º–∞—Ç–µ–ª–µ–Ω —Å –¥—Ä–æ–±—è–º–∏ (—à–∞–≥ 0.5)." },
            { id: 5, type: 'SUBTRACTION', a: 0.5, b: 2.5, expression: "0.5 - 2.5", answer: -2, description: "–î–≤–∏–≥–∞–µ–º—Å—è –≤–ª–µ–≤–æ –æ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π –¥—Ä–æ–±–∏." },
            { id: 6, type: 'ADDITION', a: -4.5, b: -2.5, expression: "-4.5 + (-2.5)", answer: -7, description: "–°—É–º–º–∞ –¥–≤—É—Ö –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –≤—Å–µ–≥–¥–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞." },
            { id: 7, type: 'MIDPOINT', a: -4, b: 2, expression: "–°–µ—Ä–µ–¥–∏–Ω–∞ [-4; 2]", answer: -1, description: "–ö–∞–∫–æ–µ —á–∏—Å–ª–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–æ—á–Ω–æ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ?" },
            { id: 8, type: 'MIDPOINT', a: -6, b: -2, expression: "–°–µ—Ä–µ–¥–∏–Ω–∞ [-6; -2]", answer: -4, description: "–ù–∞–π–¥–∏ —Ü–µ–Ω—Ç—Ä –º–µ–∂–¥—É –¥–≤—É–º—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏." },
            { id: 9, type: 'SUBTRACTION', a: -10, b: -10, expression: "-10 - (-10)", answer: 0, description: "–ß–∏—Å–ª–æ –º–∏–Ω—É—Å –æ–Ω–æ —Å–∞–º–æ –≤—Å–µ–≥–¥–∞ –¥–∞–µ—Ç –Ω–æ–ª—å." },
            { id: 10, type: 'MIDPOINT', a: -1.5, b: 1.5, expression: "–°–µ—Ä–µ–¥–∏–Ω–∞ [-1.5; 1.5]", answer: 0, description: "–°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ —á–∏—Å–ª–∞. –ì–¥–µ –∏—Ö —Ü–µ–Ω—Ç—Ä?" }
        ];

        // --- COMPONENT: NUMBER LINE ---
        const NumberLine = ({ initialValue, targetValue, userValue, onValueChange, showResult = false, highlightStart }) => {
            const svgRef = useRef(null);
            const [isDragging, setIsDragging] = useState(false);

            const getX = (val) => {
                const range = LINE_MAX - LINE_MIN;
                const availableWidth = VIEWBOX_WIDTH - 2 * MARGIN_X;
                return MARGIN_X + ((val - LINE_MIN) / range) * availableWidth;
            };

            const getValueFromX = (x) => {
                const range = LINE_MAX - LINE_MIN;
                const availableWidth = VIEWBOX_WIDTH - 2 * MARGIN_X;
                let val = LINE_MIN + ((x - MARGIN_X) / availableWidth) * range;
                val = Math.round(val / STEP) * STEP;
                return Math.max(LINE_MIN, Math.min(LINE_MAX, val));
            };

            const handlePointerDown = (e) => {
                if (showResult) return;
                setIsDragging(true);
                e.target.setPointerCapture(e.pointerId);
            };

            const handlePointerMove = (e) => {
                if (!isDragging || !svgRef.current) return;
                const rect = svgRef.current.getBoundingClientRect();
                const scaleX = VIEWBOX_WIDTH / rect.width;
                const x = (e.clientX - rect.left) * scaleX;
                onValueChange(getValueFromX(x));
            };

            const handlePointerUp = () => setIsDragging(false);

            const ticks = [];
            for (let i = LINE_MIN; i <= LINE_MAX; i++) ticks.push(i);

            const startX = getX(highlightStart !== undefined ? highlightStart : initialValue);
            const userX = getX(userValue);
            const targetX = getX(targetValue);

            return (
                <div className="w-full bg-white p-4 sm:p-8 rounded-3xl shadow-inner border border-slate-100 mb-6 select-none touch-none">
                    <svg 
                        ref={svgRef} 
                        viewBox={`0 0 ${VIEWBOX_WIDTH} ${VIEWBOX_HEIGHT}`} 
                        className="w-full h-auto cursor-pointer overflow-visible"
                        onPointerDown={handlePointerDown} 
                        onPointerMove={handlePointerMove} 
                        onPointerUp={handlePointerUp}
                    >
                        {/* Axis */}
                        <line x1={MARGIN_X} y1={VIEWBOX_HEIGHT/2} x2={VIEWBOX_WIDTH - MARGIN_X} y2={VIEWBOX_HEIGHT/2} stroke="#cbd5e1" strokeWidth="2" strokeLinecap="round" />
                        <path d={`M ${VIEWBOX_WIDTH - MARGIN_X} ${VIEWBOX_HEIGHT/2} l -10 -5 v 10 z`} fill="#cbd5e1" />
                        
                        {/* Ticks */}
                        {ticks.map(t => (
                            <g key={t}>
                                <line 
                                    x1={getX(t)} y1={VIEWBOX_HEIGHT/2 - 6} 
                                    x2={getX(t)} y2={VIEWBOX_HEIGHT/2 + 6} 
                                    stroke={t === 0 ? "#1e293b" : "#e2e8f0"} 
                                    strokeWidth={t === 0 ? "3" : "1"} 
                                />
                                {t % 2 === 0 && (
                                    <text x={getX(t)} y={VIEWBOX_HEIGHT/2 + 28} textAnchor="middle" fontSize="12" fill="#94a3b8" className="font-black">{t}</text>
                                )}
                            </g>
                        ))}

                        {/* Start Point Dot */}
                        {highlightStart !== undefined && (
                            <circle cx={getX(highlightStart)} cy={VIEWBOX_HEIGHT/2} r="6" fill="#6366f1" className="opacity-40" />
                        )}

                        {/* Result Arc */}
                        {showResult && (
                            <path 
                                d={`M ${startX} ${VIEWBOX_HEIGHT/2 - 12} Q ${(startX + targetX)/2} ${VIEWBOX_HEIGHT/2 - 60} ${targetX} ${VIEWBOX_HEIGHT/2 - 12}`} 
                                fill="none" stroke="#10b981" strokeWidth="2" strokeDasharray="6,6" 
                            />
                        )}

                        {/* User Marker */}
                        <g transform={`translate(${userX}, ${VIEWBOX_HEIGHT/2})`} className="transition-transform duration-75">
                            <path 
                                d="M 0 -8 L 14 -32 L -14 -32 Z" 
                                fill={showResult ? (userValue === targetValue ? "#10b981" : "#ef4444") : "#4f46e5"} 
                                className="transition-colors duration-300"
                            />
                            <text y="-40" textAnchor="middle" fontSize="20" fontWeight="900" fill={showResult ? (userValue === targetValue ? "#10b981" : "#ef4444") : "#4f46e5"}>
                                {userValue}
                            </text>
                        </g>

                        {/* Target Answer Marker (on error) */}
                        {showResult && userValue !== targetValue && (
                            <g transform={`translate(${targetX}, ${VIEWBOX_HEIGHT/2})`}>
                                <circle r="5" fill="#10b981" />
                                <text y="45" textAnchor="middle" fontSize="13" fill="#10b981" fontWeight="800">–í–µ—Ä–Ω–æ: {targetValue}</text>
                            </g>
                        )}
                    </svg>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const problems = useMemo(() => generateProblems(), []);
            const [currentIdx, setCurrentIdx] = useState(0);
            const [score, setScore] = useState(0);
            const [isFinished, setIsFinished] = useState(false);
            const [userValue, setUserValue] = useState(0);
            const [showFeedback, setShowFeedback] = useState(false);
            const [aiExplanation, setAiExplanation] = useState(null);
            const [isLoading, setIsLoading] = useState(false);

            const problem = problems[currentIdx];

            useEffect(() => {
                setUserValue(0);
                setShowFeedback(false);
                setAiExplanation(null);
            }, [currentIdx]);

            const handleCheck = async () => {
                setShowFeedback(true);
                setIsLoading(true);
                const correct = userValue === problem.answer;
                if (correct) setScore(s => s + 1);

                // Dynamically import GenAI inside the check to satisfy SDK rules while being local-friendly
                try {
                    const { GoogleGenAI } = await import('https://esm.sh/@google/genai@^1.40.0');
                    const aiClient = new GoogleGenAI({ apiKey: (window.process?.env?.API_KEY || '') });
                    const prompt = `–¢—ã - —É—á–∏—Ç–µ–ª—å –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏. –ö—Ä–∞—Ç–∫–æ (1-2 –ø—Ä–µ–¥–ª) –æ–±—ä—è—Å–Ω–∏ –∑–∞–¥–∞—á—É "${problem.expression}" –Ω–∞ —á–∏—Å–ª–æ–≤–æ–π –ø—Ä—è–º–æ–π. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${problem.answer}. –£—á–µ–Ω–∏–∫ –æ—Ç–≤–µ—Ç–∏–ª: ${userValue}. –û—Ç–≤–µ—á–∞–π –ø–æ-—Ä—É—Å—Å–∫–∏.`;
                    
                    const response = await aiClient.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: prompt,
                    });
                    setAiExplanation(response.text || "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!");
                } catch (e) {
                    console.error(e);
                    setAiExplanation(correct ? "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¢—ã –º–æ–ª–æ–¥–µ—Ü." : `–ù–µ —Å–æ–≤—Å–µ–º. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç ${problem.answer}. –ü–æ–ø—Ä–æ–±—É–π —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É!`);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleNext = () => {
                if (currentIdx < TOTAL_PROBLEMS - 1) setCurrentIdx(currentIdx + 1);
                else setIsFinished(true);
            };

            if (isFinished) {
                return (
                    <div className="min-h-screen grid-paper flex items-center justify-center p-6">
                        <div className="max-w-md w-full bg-white rounded-[2.5rem] shadow-2xl p-10 text-center border-8 border-indigo-50">
                            <div className="text-8xl mb-6 animate-bounce-slow">üèÜ</div>
                            <h1 className="text-4xl font-black text-slate-800 mb-2">–§–∏–Ω–∏—à!</h1>
                            <p className="text-slate-500 mb-8 text-xl font-medium">
                                –¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span className="text-indigo-600 font-black">{score}</span> –∏–∑ {TOTAL_PROBLEMS}
                            </p>
                            <button 
                                onClick={() => window.location.reload()} 
                                className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-black py-5 rounded-2xl transition-all shadow-xl shadow-indigo-100 active:scale-95"
                            >
                                –ü–û–í–¢–û–†–ò–¢–¨
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col items-center py-12 px-4">
                    <header className="w-full max-w-4xl mb-12 flex justify-between items-end">
                        <div>
                            <h1 className="text-4xl font-black text-slate-900 tracking-tighter">Math<span className="text-indigo-600">Line</span></h1>
                            <p className="text-slate-400 font-bold uppercase text-[10px] tracking-[0.2em]">–¢—Ä–µ–Ω–∞–∂–µ—Ä: 6 –∫–ª–∞—Å—Å ‚Ä¢ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞</p>
                        </div>
                        <div className="bg-white px-6 py-2 rounded-2xl shadow-sm border border-slate-100 font-black text-slate-600">
                            {currentIdx + 1} / {TOTAL_PROBLEMS}
                        </div>
                    </header>

                    <main className="w-full max-w-4xl flex flex-col gap-8">
                        <div className="bg-white rounded-[3rem] shadow-2xl p-8 sm:p-12 border border-slate-100 relative overflow-visible">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-8 mb-12">
                                <div className="text-center md:text-left">
                                    <span className="inline-block px-4 py-1 bg-indigo-50 text-indigo-500 text-[10px] font-black uppercase tracking-widest rounded-full mb-4">
                                        {problem.type === 'MIDPOINT' ? '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã' : '–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞'}
                                    </span>
                                    <h2 className="text-6xl font-black math-font text-slate-900 mb-4">{problem.expression}</h2>
                                    <p className="text-slate-500 font-semibold text-lg">{problem.description}</p>
                                </div>
                                
                                {!showFeedback ? (
                                    <button 
                                        onClick={handleCheck} 
                                        className="bg-indigo-600 hover:bg-indigo-700 text-white px-12 py-5 rounded-2xl font-black text-lg shadow-2xl shadow-indigo-100 transition-all active:scale-95"
                                    >
                                        –ü–†–û–í–ï–†–ò–¢–¨
                                    </button>
                                ) : (
                                    <button 
                                        onClick={handleNext} 
                                        className="bg-slate-900 hover:bg-slate-800 text-white px-12 py-5 rounded-2xl font-black text-lg shadow-2xl shadow-slate-200 transition-all active:scale-95"
                                    >
                                        –î–ê–õ–ï–ï ‚Üí
                                    </button>
                                )}
                            </div>

                            <NumberLine 
                                initialValue={problem.a} 
                                targetValue={problem.answer} 
                                userValue={userValue} 
                                onValueChange={setUserValue} 
                                showResult={showFeedback} 
                                highlightStart={problem.type === 'MIDPOINT' ? undefined : problem.a} 
                            />
                        </div>

                        {showFeedback && (
                            <div className={`rounded-[2rem] p-10 border-4 flex flex-col md:flex-row gap-10 items-center animate-in fade-in slide-in-from-bottom-8 duration-700 ${
                                userValue === problem.answer ? 'bg-emerald-50 border-emerald-100' : 'bg-rose-50 border-rose-100'
                            }`}>
                                <div className={`text-5xl w-20 h-20 flex items-center justify-center rounded-3xl shrink-0 font-black shadow-lg ${
                                    userValue === problem.answer ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'
                                }`}>
                                    {userValue === problem.answer ? '‚úì' : '‚úó'}
                                </div>
                                <div className="flex-1 text-center md:text-left">
                                    <h3 className={`font-black text-2xl mb-2 ${userValue === problem.answer ? 'text-emerald-800' : 'text-rose-800'}`}>
                                        {userValue === problem.answer ? '–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ!' : '–ü–æ—á—Ç–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å!'}
                                    </h3>
                                    <p className="text-slate-600 text-lg font-medium leading-relaxed">
                                        {isLoading ? (
                                            <span className="flex gap-2 justify-center md:justify-start">
                                                <span className="w-3 h-3 bg-indigo-300 rounded-full animate-bounce"></span>
                                                <span className="w-3 h-3 bg-indigo-300 rounded-full animate-bounce delay-100"></span>
                                                <span className="w-3 h-3 bg-indigo-300 rounded-full animate-bounce delay-200"></span>
                                            </span>
                                        ) : aiExplanation}
                                    </p>
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="mt-12 text-slate-300 text-[10px] font-black uppercase tracking-[0.3em]">
                        MathLine Interactive Training System ‚Ä¢ 2025
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>